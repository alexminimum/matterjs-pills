<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>matter js</title>
  </head>
  <style>
    body {
      margin: 0;
    }
    .hero {
      overflow: hidden;
      height: 85vh;
      background-color: #0c0c0c;
    }
    .hero canvas {
      display: block;
    }
  </style>
  <body>
    <section class="hero"></section>
    <script src="https://rawgit.com/robb0wen/tornis/master/dist/tornis.es5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.12.0/matter.min.js"></script>
    <script src="main.js"></script>
  </body>
</html>

<!- main.js ->
<script>

var velocity = { x: 0, y: 0 };

const updateValues = ({ position }) => {
  if (position.changed) {
    velocity = position.velocity;
  }
};

tornis.watchViewport(updateValues);

let Engine = Matter.Engine,
  Render = Matter.Render,
  World = Matter.World,
  Bodies = Matter.Bodies,
  Events = Matter.Events,
  MouseConstraint = Matter.MouseConstraint,
  Mouse = Matter.Mouse;

let engine = Engine.create();
let element = document.querySelector(".hero");

function init() {
  let elRect = element.getBoundingClientRect();
  console.log("elRect", elRect);

  //   let numm = Math.random();
  $("canvas").remove();

  let width = elRect.width;
  let height = elRect.height;
  //   let vmin = Math.min(width, height);

  engine.events = {};
  World.clear(engine.world);
  Engine.clear(engine);

  engine = Engine.create();

  let render = Render.create({
    element: element,
    engine: engine,
    options: {
      wireframes: false,
      background: "transparent",
      width: width,
      height: height,
    },
  });

  World.add(engine.world, [
    //floor
    Bodies.rectangle(width / 2, height + 50, width + 300, 100, {
      isStatic: true,
      render: {
        fillStyle: "green",
      },
    }),
    //roof
    Bodies.rectangle(width / 2, -210, width, 100, {
      isStatic: true,
      render: {
        fillStyle: "blue",
      },
    }),
    //left
    Bodies.rectangle(-150, height / 2, 100, height, {
      isStatic: true,
      render: {
        fillStyle: "orange",
      },
    }),
    //right
    Bodies.rectangle(width + 150, height / 2, 100, height, {
      isStatic: true,
      render: {
        fillStyle: "pruple",
      },
    }),
  ]);


  for (let i = 0; i <= 5; i++) {
    World.add(
      engine.world,
      Bodies.rectangle(Math.random() * width, -200, 166, 48, {
        chamfer: { radius: 24 },
        render: {
          sprite: {
            texture:
              "https://uploads-ssl.webflow.com/62455c11c0e6cfa2d44856a7/624ebb1a770d706838e7aaae_aprendizaje-pill.png",
            xScale: 0.5,
            yScale: 0.5,
          },
        },
      })
    );
  }

  for (let i = 0; i <= 3; i++) {
    World.add(
      engine.world,
      Bodies.rectangle(Math.random() * width, -200, 151, 48, {
        chamfer: { radius: 24 },
        render: {
          sprite: {
            texture:
              "https://uploads-ssl.webflow.com/62455c11c0e6cfa2d44856a7/624ebb1bf64f4d48d16b973d_fundacion-pill.png",
            xScale: 0.5,
            yScale: 0.5,
          },
        },
      })
    );
  }

  for (let i = 0; i <= 5; i++) {
    World.add(
      engine.world,
      Bodies.rectangle(Math.random() * width, -200, 155, 48, {
        chamfer: { radius: 24 },
        render: {
          sprite: {
            texture:
              "https://uploads-ssl.webflow.com/62455c11c0e6cfa2d44856a7/624ebb1a9582869e27688ed5_innovacion-pill.png",
            xScale: 0.5,
            yScale: 0.5,
          },
        },
      })
    );
  }

  for (let i = 0; i <= 4; i++) {
    World.add(
      engine.world,
      Bodies.rectangle(Math.random() * width, -200, 164, 48, {
        chamfer: { radius: 24 },
        render: {
          sprite: {
            texture:
              "https://uploads-ssl.webflow.com/62455c11c0e6cfa2d44856a7/624eb11137122dfaa3cc0eec_comunidad.png",
            xScale: 0.5,
            yScale: 0.5,
          },
        },
      })
    );
  }

  // add mouse control
  var mouse = Mouse.create(render.canvas),
    mouseConstraint = MouseConstraint.create(engine, {
      mouse: mouse,
      constraint: {
        stiffness: 0.2,
        render: {
          visible: false,
        },
      },
    });

  World.add(engine.world, mouseConstraint);

  // keep the mouse in sync with rendering
  render.mouse = mouse;

  // Allow page scrolling in matter.js window
  mouse.element.removeEventListener("mousewheel", mouse.mousewheel);
  mouse.element.removeEventListener("DOMMouseScroll", mouse.mousewheel);

  // Detect clicks vs. drags
  let click = false;

  document.addEventListener("mousedown", () => (click = true));
  document.addEventListener("mousemove", () => (click = false));
  document.addEventListener("mouseup", () =>
    console.log(click ? "click" : "drag")
  );

  // Create a On-Mouseup Event-Handler
  Events.on(mouseConstraint, "mouseup", function (event) {
    var mouseConstraint = event.source;
    var bodies = engine.world.bodies;
    if (!mouseConstraint.bodyB) {
      for (i = 0; i < bodies.length; i++) {
        var body = bodies[i];
        // Check if clicked or dragged
        if (click === true) {
          if (
            Matter.Bounds.contains(body.bounds, mouseConstraint.mouse.position)
          ) {
            var bodyUrl = body.url;
            console.log("Body.Url >> " + bodyUrl);
            // Hyperlinking feature
            if (bodyUrl != undefined) {
              //window.location.href = bodyUrl;
              window.open(bodyUrl, "_blank");
              console.log("Hyperlink was opened");
            }
            break;
          }
        }
      }
    }
  });

  Engine.run(engine);

  Render.run(render);
  let num = 0;
  function update() {
    engine.world.gravity.x = velocity.x / 2;
    engine.world.gravity.y = velocity.y + 1;
    idRAF = requestAnimationFrame(update.bind(this));
  }
  update();
}

init();

$(window).resize(function () {
  init();
});
</script>
